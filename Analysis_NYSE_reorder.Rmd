---
output:
  word_document: default
  html_document: default
  pdf_document: default
---
Load the data

```{r include=FALSE,message=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
library(quantmod)
library(sjPlot)
nyse <- read.csv("Test01.csv", header=TRUE, sep=",")

library(dplyr)
nyse_num<-nyse
for(i in 2:132){
  nyse_num[,i]<-as.numeric(nyse_num[,i])
}
nyse_num_clean<-na.omit(nyse_num)
```
Transpose
```{r}
t_nyse_big<-setNames(data.frame(t(nyse_num_clean[ , - 1])), nyse_num_clean[ , 1])
t_nyse<-na.omit(t_nyse_big)
rownames(t_nyse) <-sub("X", "", rownames(t_nyse))
rownames(t_nyse) <-sub("\\.", "-", rownames(t_nyse))
rownames(t_nyse) <-sub("\\.", "\\-", rownames(t_nyse))
```
Calculate returns
```{r}
library(dplyr)
library(quantmod)
library(xts)
library(PerformanceAnalytics)

ret_nyse<-Return.calculate(t_nyse, method="discrete")
ret_nyse<-ret_nyse[-1,]
```


Create data set with worst 10 tickers every week
```{r}
ret_nyse_sorted<-ret_nyse
weekly_sort<-data.frame()
worst_10<-data.frame(ncol=10)
col_names<-data.frame()


for (j in 1:130){
  a=sort(ret_nyse_sorted[j,], decreasing=FALSE)
  worst_10<-a[1:10]
  col_names<-c(colnames(worst_10))
  col_names<-as.data.frame(col_names)
  t_col_names<-t(col_names)
  weekly_sort<-rbind(weekly_sort,t_col_names)
}
rownames(weekly_sort) = rownames(t_nyse[-1,])
```

New attempt company number/column number
First create a dataset with col names matched with col num
```{r}
col_as_numbers<-as.data.frame(t(colnames(ret_nyse)))
colnames(col_as_numbers)<-c(1:ncol(col_as_numbers))
#col_as_numbers<-as.data.frame(t(c(1:ncol(ret_nyse))))
#col_as_numbers<-rbind(col_as_numbers,col_name_string)
#colnames(col_as_numbers) = col_as_numbers[,1]
```
create new dataset with col num instead of col name
```{r}
ret_nyse_cncn<-ret_nyse
colnames(ret_nyse_cncn)<-c(1:1870)
```

Create dataset with worst returns both name, number and actual return
```{r}
ret_nyse_sorted_n<-ret_nyse_cncn
weekly_sort_n<-data.frame()
worst_10_n<-data.frame(ncol=10)
col_name_n<-data.frame()
row_name_n<-data.frame(c(rownames(weekly_sort)))
ret_worst_10<-data.frame()
  #ncol=10, row_name_n[,1])
#rownames(ret_worst_10)<-ret_worst_10[,1]

for (j in 1:130){
  a=sort(ret_nyse_sorted_n[j,], decreasing=FALSE)
  worst_10_n<-a[1:10]
  unlst_worst_10<-as.data.frame(unlist(worst_10_n[1,], use.names=FALSE))
  t_unlst_worst_10<-as.data.frame(t(unlst_worst_10))
  ret_worst_10<-rbind(ret_worst_10,t_unlst_worst_10)
  col_names_n<-c(colnames(worst_10_n))
  col_names_n<-as.data.frame(col_names_n)
  t_col_names_n<-t(col_names_n)
  weekly_sort_n<-rbind(weekly_sort_n,t_col_names_n)
  
}

rownames(weekly_sort_n)<-c(rownames(weekly_sort))
rownames(ret_worst_10)<-c(rownames(weekly_sort))

```

Calculate returns 1 week after
Previously working chunk of code
```{r}
ret_1w<-data.frame()
for(k in 1:130){
  for(l in 1:10){
    ret_1w[k,l]<-ret_nyse_cncn[k+1,weekly_sort_n[k,l]]
    #ret_1w[k,l]<-ret_nyse_cncn[k+1,weekly_sort_n[k,l]]
   }
}
```

Find returns for holding period of 2 and 3 weeks respectively
```{r}
ret_2w<-data.frame()
for(k in 1:130){
  for(l in 1:10){
    ret_2w[k,l]<-ret_nyse_cncn[k+2,weekly_sort_n[k,l]]
   }
}

ret_3w<-data.frame()
for(k in 1:130){
  for(l in 1:10){
    ret_3w[k,l]<-ret_nyse_cncn[k+3,weekly_sort_n[k,l]]
   }
}

ret_2w_c<-data.frame()
ret_3w_c<-data.frame()

#ret_1w<-ret_1w+1
#ret_2w<-ret_2w+1
#ret_3w<-ret_3w+1
ret_2w_c<-((ret_1w+1)*(ret_2w+1))-1
ret_3w_c<-((ret_1w+1)*(ret_2w+1)*(ret_3w+1))-1
```

Calculate average return for each portfolio

```{r}
library(pastecs)
at0<-rowMeans(ret_worst_10)
#RETURNS 1 WEEK
a1w<-rowMeans(ret_1w[,])
ret_1w$Average1w <- a1w

#stat.desc(ret_1w$Average1w)
#boxplot(ret_1w$Average1w)
```

```{r}
#RETURNS 2 WEEKS
a2w<-rowMeans(ret_2w_c[,])
ret_2w_c$Average2w <- a2w
#stat.desc(ret_2w_c$Average2w)
#boxplot(ret_2w$Average2w)

```
```{r}
#RETURNS 3 WEEKS
a3w<-rowMeans(ret_3w_c[,])
ret_3w_c$Average3w <- a3w
#stat.desc(ret_3w_c$Average3w)
#boxplot(ret_2w$Average2w)

```

```{r}
avret<-data.frame(at0,a1w,a2w,a3w)
stat.desc(avret)
boxplot(avret)
```
Average return of each ticker
```{r}
av_ret_tot<-data.frame()

for (m in 1:1870){
  av_ret_tot[1,m]<-mean(ret_nyse[,m])
}
t_av_ret_tot<-as.data.frame(t(av_ret_tot))
```





################################                         ####################
################################     1st PERCENTILE      ####################
################################                         ####################

Create dataset for first percentile with tickers name
```{r}
ret_nyse_sorted<-ret_nyse
weekly_sort_1pct<-data.frame()
worst_1pct<-data.frame(ncol=20)
col_names<-data.frame()


for (j in 1:130){
  a=sort(ret_nyse_sorted[j,], decreasing=FALSE)
  worst_1pct<-a[1:20]
  col_names<-c(colnames(worst_1pct))
  col_names<-as.data.frame(col_names)
  t_col_names<-t(col_names)
  weekly_sort_1pct<-rbind(weekly_sort_1pct,t_col_names)
}
rownames(weekly_sort_1pct) = rownames(t_nyse[-1,])
```

Create a new dataset with the first percentile with variable number
```{r}
ret_nyse_sorted_n<-ret_nyse_cncn
weekly_sort_n_1pct<-data.frame()
worst_n_1pct<-data.frame(ncol=20)
col_name_n_1pct<-data.frame()
row_name_n_1pct<-data.frame(c(rownames(weekly_sort)))
ret_worst_n_1pct<-data.frame()

for (j in 1:130){
  a=sort(ret_nyse_sorted_n[j,], decreasing=FALSE)
  worst_n_1pct<-a[1:20]
  unlst_worst_n_1pct<-as.data.frame(unlist(worst_n_1pct[1,], use.names=FALSE))
  t_unlst_worst_n_1pct<-as.data.frame(t(unlst_worst_n_1pct))
  ret_worst_n_1pct<-rbind(ret_worst_n_1pct,t_unlst_worst_n_1pct)
  col_names_n_1pct<-c(colnames(worst_n_1pct))
  col_names_n_1pct<-as.data.frame(col_names_n_1pct)
  t_col_names_n_1pct<-t(col_names_n_1pct)
  weekly_sort_n_1pct<-rbind(weekly_sort_n_1pct,t_col_names_n_1pct)
}

rownames(weekly_sort_n)<-c(rownames(weekly_sort))
rownames(ret_worst_10)<-c(rownames(weekly_sort))

```

Calculate returns 1 week after
```{r}
ret_1w_1pct<-data.frame()
for(k in 1:130){
  for(l in 1:20){
    ret_1w_1pct[k,l]<-ret_nyse_cncn[k+1,weekly_sort_n_1pct[k,l]]
   }
}
```

Find returns for holding period of 2 and 3 weeks respectively
```{r}
ret_2w_1pct<-data.frame()
for(k in 1:130){
  for(l in 1:20){
    ret_2w_1pct[k,l]<-ret_nyse_cncn[k+2,weekly_sort_n_1pct[k,l]]
   }
}

ret_3w_1pct<-data.frame()
for(k in 1:130){
  for(l in 1:20){
    ret_3w_1pct[k,l]<-ret_nyse_cncn[k+3,weekly_sort_n_1pct[k,l]]
   }
}

ret_2w_c_1pct<-data.frame()
ret_3w_c_1pct<-data.frame()

#ret_1w_1pct<-ret_1w_1pct+1
#ret_2w_1pct<-ret_2w_1pct+1
#ret_3w_1pct<-ret_3w_1pct+1
ret_2w_c_1pct<-((ret_1w_1pct+1)*(ret_2w_1pct+1))-1
ret_3w_c_1pct<-((ret_1w_1pct+1)*(ret_2w_1pct+1)*(ret_3w_1pct+1))-1
```

Calculate average return for each portfolio

```{r}
library(pastecs)
#RETURNS 1 WEEK
at0_1pct<-rowMeans(ret_worst_n_1pct[,])
a1w_1pct<-rowMeans(ret_1w_1pct[,])
ret_1w_1pct$Average1w <- a1w_1pct
a2w_1pct<-rowMeans(ret_2w_c_1pct[,])
ret_2w_c_1pct$Average2w <- a2w_1pct
a3w_1pct<-rowMeans(ret_3w_c_1pct[,])
ret_3w_c_1pct$Average3w <- a3w_1pct

avret_1pct<-data.frame(at0_1pct,a1w_1pct,a2w_1pct,a3w_1pct)
stat.desc(avret_1pct)
boxplot(avret_1pct)
```

################################                         ####################
################################     5th PERCENTILE      ####################
################################                         ####################


Create dataset for fifth percentile with tickers name
```{r}
ret_nyse_sorted<-ret_nyse
weekly_sort_5pct<-data.frame()
worst_5pct<-data.frame(ncol=95)
col_names<-data.frame()


for (j in 1:130){
  a=sort(ret_nyse_sorted[j,], decreasing=FALSE)
  worst_5pct<-a[1:95]
  col_names<-c(colnames(worst_5pct))
  col_names<-as.data.frame(col_names)
  t_col_names<-t(col_names)
  weekly_sort_5pct<-rbind(weekly_sort_5pct,t_col_names)
}
rownames(weekly_sort_5pct) = rownames(t_nyse[-1,])
```

Create a new dataset with the fifth percentile with variable number
```{r}
ret_nyse_sorted_n<-ret_nyse_cncn
weekly_sort_n_5pct<-data.frame()
worst_n_5pct<-data.frame(ncol=95)
col_name_n_5pct<-data.frame()
row_name_n_5pct<-data.frame(c(rownames(weekly_sort)))
ret_worst_n_5pct<-data.frame()

for (j in 1:130){
  a=sort(ret_nyse_sorted_n[j,], decreasing=FALSE)
  worst_n_5pct<-a[1:95]
  unlst_worst_n_5pct<-as.data.frame(unlist(worst_n_5pct[1,], use.names=FALSE))
  t_unlst_worst_n_5pct<-as.data.frame(t(unlst_worst_n_5pct))
  ret_worst_n_5pct<-rbind(ret_worst_n_5pct,t_unlst_worst_n_5pct)
  col_names_n_5pct<-c(colnames(worst_n_5pct))
  col_names_n_5pct<-as.data.frame(col_names_n_5pct)
  t_col_names_n_5pct<-t(col_names_n_5pct)
  weekly_sort_n_5pct<-rbind(weekly_sort_n_5pct,t_col_names_n_5pct)
}

rownames(weekly_sort_n)<-c(rownames(weekly_sort))
rownames(ret_worst_10)<-c(rownames(weekly_sort))

```

Calculate returns 1 week after
```{r}
ret_1w_5pct<-data.frame()
for(k in 1:130){
  for(l in 1:95){
    ret_1w_5pct[k,l]<-ret_nyse_cncn[k+1,weekly_sort_n_5pct[k,l]]
   }
}
```

Find returns for holding period of 2 and 3 weeks respectively
```{r}
ret_2w_5pct<-data.frame()
for(k in 1:130){
  for(l in 1:95){
    ret_2w_5pct[k,l]<-ret_nyse_cncn[k+2,weekly_sort_n_5pct[k,l]]
   }
}

ret_3w_5pct<-data.frame()
for(k in 1:130){
  for(l in 1:95){
    ret_3w_5pct[k,l]<-ret_nyse_cncn[k+3,weekly_sort_n_5pct[k,l]]
   }
}

ret_2w_c_5pct<-data.frame()
ret_3w_c_5pct<-data.frame()

#ret_1w_5pct<-ret_1w_5pct+1
#ret_2w_5pct<-ret_2w_5pct+1
#ret_3w_5pct<-ret_3w_5pct+1
ret_2w_c_5pct<-((ret_1w_5pct+1)*(ret_2w_5pct+1))-1
ret_3w_c_5pct<-((ret_1w_5pct+1)*(ret_2w_5pct+1)*(ret_3w_5pct+1))-1
```

Calculate average return for each portfolio

```{r}
library(pastecs)
#RETURNS 1 WEEK
at0_5pct<-rowMeans(ret_worst_n_5pct)
a1w_5pct<-rowMeans(ret_1w_5pct[,])
ret_1w_5pct$Average1w <- a1w_5pct
a2w_5pct<-rowMeans(ret_2w_c_5pct[,])
ret_2w_c_5pct$Average2w <- a2w_5pct
a3w_5pct<-rowMeans(ret_3w_c_5pct[,])
ret_3w_c_5pct$Average3w <- a3w_5pct

avret_5pct<-data.frame(at0_5pct,a1w_5pct,a2w_5pct,a3w_5pct)
stat.desc(avret_5pct)
```




Create boxplots
```{r}
par(mfrow = c(1, 4))
boxplot(avret, las=2, col=2, ylab="Return", xlab="Worst 10")
boxplot(avret_1pct, las=2, col=3, ylab="Return", "99th Percentile")
boxplot(avret_5pct, las=2, col=4, ylab="Return", "95th Percentile")

```

Remove outliers
```{r}

Q11 <- quantile(avret[,1], .25, na.rm=TRUE)
Q31 <- quantile(avret[,1], .75, na.rm=TRUE)
IQR1 <- IQR(avret[,1], na.rm = TRUE)
avret_no_out_1 <- as.data.frame(subset(avret[,1], avret[,1] > (Q11 - 1.5*IQR1) & avret[,1] < (Q31 + 1.5*IQR1)))
Q12 <- quantile(avret[,2], .25, na.rm=TRUE)
Q32<- quantile(avret[,2], .75, na.rm=TRUE)
IQR2 <- IQR(avret[,2], na.rm = TRUE)
avret_no_out_2 <- as.data.frame(subset(avret[,2], avret[,2] > (Q12 - 1.5*IQR2) & avret[,2] < (Q32 + 1.5*IQR2)))
Q13 <- quantile(avret[,3], .25, na.rm=TRUE)
Q33 <- quantile(avret[,3], .75, na.rm=TRUE)
IQR3 <- IQR(avret[,3], na.rm = TRUE)
avret_no_out_3 <- as.data.frame(subset(avret[,3], avret[,3] > (Q13 - 1.5*IQR3) & avret[,3] < (Q33 + 1.5*IQR3)))
  #subset(data, data$Apperance > (Q1 - 1.5*IQR) & data$Apperance < (Q3 + 1.5*IQR))
#summary(avret_no_out_1)
#stat.desc(avret_no_out_1[,1])
```
```{r}
#Plot graphs
par(mfrow = c(1, 3))
boxplot(avret_no_out_1)
boxplot(avret_no_out_2 )
boxplot(avret_no_out_3)

```
Remove outliers from first percentile
```{r}

Q11_1pct <- quantile(avret[,1], .25, na.rm=TRUE)
Q31_1pct <- quantile(avret[,1], .75, na.rm=TRUE)
IQR1_1pct <- IQR(avret[,1], na.rm = TRUE)
avret_no_out_1_1pct <- as.data.frame(subset(avret_1pct[,1], avret_1pct[,1] > (Q11_1pct - 1.5*IQR1_1pct) & avret_1pct[,1] < (Q31_1pct + 1.5*IQR1_1pct)))
Q12_1pct <- quantile(avret_1pct[,2], .25, na.rm=TRUE)
Q32_1pct<- quantile(avret_1pct[,2], .75, na.rm=TRUE)
IQR2_1pct <- IQR(avret_1pct[,2], na.rm = TRUE)
avret_no_out_2_1pct <- as.data.frame(subset(avret_1pct[,2], avret_1pct[,2] > (Q12_1pct - 1.5*IQR2_1pct) & avret_1pct[,2] < (Q32_1pct + 1.5*IQR2_1pct)))
Q13_1pct <- quantile(avret_1pct[,3], .25, na.rm=TRUE)
Q33_1pct <- quantile(avret_1pct[,3], .75, na.rm=TRUE)
IQR3_1pct <- IQR(avret_1pct[,3], na.rm = TRUE)
avret_no_out_3_1pct <- as.data.frame(subset(avret_1pct[,3], avret_1pct[,3] > (Q13_1pct - 1.5*IQR3_1pct) & avret_1pct[,3] < (Q33_1pct + 1.5*IQR3_1pct)))
  #subset(data, data$Apperance > (Q1 - 1.5*IQR) & data$Apperance < (Q3 + 1.5*IQR))
#summary(avret_no_out_1)
#stat.desc(avret_no_out_1[,1])

#Plot graphs
par(mfrow = c(1, 3))
boxplot(avret_no_out_1_1pct)
boxplot(avret_no_out_2_1pct)
boxplot(avret_no_out_3_1pct)

```

Remove outliers from fifth percentile
```{r}

Q11_5pct <- quantile(avret[,1], .25, na.rm=TRUE)
Q31_5pct <- quantile(avret[,1], .75, na.rm=TRUE)
IQR1_5pct <- IQR(avret[,1], na.rm = TRUE)
avret_no_out_1_5pct <- as.data.frame(subset(avret_5pct[,1], avret_5pct[,1] > (Q11_5pct - 1.5*IQR1_5pct) & avret_5pct[,1] < (Q31_5pct + 1.5*IQR1_5pct)))
Q12_5pct <- quantile(avret_5pct[,2], .25, na.rm=TRUE)
Q32_5pct<- quantile(avret_5pct[,2], .75, na.rm=TRUE)
IQR2_5pct <- IQR(avret_5pct[,2], na.rm = TRUE)
avret_no_out_2_5pct <- as.data.frame(subset(avret_5pct[,2], avret_5pct[,2] > (Q12_5pct - 1.5*IQR2_5pct) & avret_5pct[,2] < (Q32_5pct + 1.5*IQR2_5pct)))
Q13_5pct <- quantile(avret_5pct[,3], .25, na.rm=TRUE)
Q33_5pct <- quantile(avret_5pct[,3], .75, na.rm=TRUE)
IQR3_5pct <- IQR(avret_5pct[,3], na.rm = TRUE)
avret_no_out_3_5pct <- as.data.frame(subset(avret_5pct[,3], avret_5pct[,3] > (Q13_5pct - 1.5*IQR3_5pct) & avret_5pct[,3] < (Q33_5pct + 1.5*IQR3_5pct)))
  #subset(data, data$Apperance > (Q1 - 1.5*IQR) & data$Apperance < (Q3 + 1.5*IQR))
#summary(avret_no_out_1)
#stat.desc(avret_no_out_1[,1])


#Plot graphs
par(mfrow = c(1, 3))
boxplot(avret_no_out_1_5pct)
boxplot(avret_no_out_2_5pct)
boxplot(avret_no_out_3_5pct)

```

Plot returns

```{r}

avret_a<-avret
avret_a$ptf<-1
avret_1pct_a<-avret_1pct
avret_1pct_a$ptf<-2
colnames(avret_1pct_a)<-colnames(avret_a)
avret_5pct_a<-avret_5pct
avret_5pct_a$ptf<-3
colnames(avret_5pct_a)<-colnames(avret_a)
avret_a_tot<-rbind(avret_a,avret_1pct_a,avret_5pct_a)

library(ggplot2)
ggplot(avret_a_tot) +
  aes(x = ptf, y=a1w, color = ptf) +
  geom_jitter() +
  theme(legend.position = "none")


pairs(at0~a1w+a2w+a3w, data=avret)

#pairs(at0~a1w+a2w+a3w, data=avret_1pct)
#pairs(at0~a1w+a2w+a3w, data=avret_5pct)
```

#################################      No Compound     ###########################
#################################      No Compound     ###########################
#################################      No Compound     ###########################



```{r}
avret_no_comp<-data.frame()
avret_no_comp<-as.data.frame(cbind(rowMeans(ret_worst_10),ret_1w[,11],rowMeans(ret_2w),rowMeans(ret_3w)))
colnames(avret_no_comp)<-c("at0","a1w","a2w","a3w")

avret_no_comp_1pct<-data.frame()
avret_no_comp_1pct<-as.data.frame(cbind(rowMeans(ret_worst_n_1pct),ret_1w_1pct[,21],rowMeans(ret_2w_1pct),rowMeans(ret_3w_1pct)))
colnames(avret_no_comp_1pct)<-c("at0","a1w","a2w","a3w")

avret_no_comp_5pct<-data.frame()
avret_no_comp_5pct<-as.data.frame(cbind(rowMeans(ret_worst_n_5pct),ret_1w_5pct[,96],rowMeans(ret_2w_5pct),rowMeans(ret_3w_5pct)))
colnames(avret_no_comp_5pct)<-c("at0","a1w","a2w","a3w")

par(mfrow = c(1, 3))
boxplot(avret_no_comp, outline=FALSE, col = 2, ylab="Return", xlab="Worst 10")
boxplot(avret_no_comp_1pct, outline=FALSE, col=3, ylab="Return", xlab="99th Percentile")
boxplot(avret_no_comp_5pct, outline=FALSE, col=4, ylab="Return", xlab="95th Percentile")



```
TABLE WITH AVERAGE OF THE AVERAGES
```{r}
#WITH COMPOUNDING
av_av<-data.frame()
av_av[1,1]<-mean(avret[,1], na.rm=TRUE)
av_av[1,2]<-mean(avret[,2], na.rm=TRUE)
av_av[1,3]<-mean(avret[,3], na.rm=TRUE)
av_av[1,4]<-mean(avret[,4], na.rm=TRUE)
av_av[2,1]<-sd(avret[,1], na.rm=TRUE)
av_av[2,2]<-sd(avret[,2], na.rm=TRUE)
av_av[2,3]<-sd(avret[,3], na.rm=TRUE)
av_av[2,4]<-sd(avret[,4], na.rm=TRUE)

av_av[3,1]<-mean(avret_1pct[,1], na.rm=TRUE)
av_av[3,2]<-mean(avret_1pct[,2], na.rm=TRUE)
av_av[3,3]<-mean(avret_1pct[,3], na.rm=TRUE)
av_av[3,4]<-mean(avret_1pct[,4], na.rm=TRUE)
av_av[4,1]<-sd(avret_1pct[,1], na.rm=TRUE)
av_av[4,2]<-sd(avret_1pct[,2], na.rm=TRUE)
av_av[4,3]<-sd(avret_1pct[,3], na.rm=TRUE)
av_av[4,4]<-sd(avret_1pct[,4], na.rm=TRUE)

av_av[5,1]<-mean(avret_5pct[,1], na.rm=TRUE)
av_av[5,2]<-mean(avret_5pct[,2], na.rm=TRUE)
av_av[5,3]<-mean(avret_5pct[,3], na.rm=TRUE)
av_av[5,4]<-mean(avret_5pct[,4], na.rm=TRUE)
av_av[6,1]<-sd(avret_5pct[,1], na.rm=TRUE)
av_av[6,2]<-sd(avret_5pct[,2], na.rm=TRUE)
av_av[6,3]<-sd(avret_5pct[,3], na.rm=TRUE)
av_av[6,4]<-sd(avret_5pct[,4], na.rm=TRUE)


colnames(av_av)<-c("T0","a1w","a2w","a3w")
rownames(av_av)<-c("Mean_p1","St.Dev_p1","Mean_p2","St.Dev_p2","Mean_p3","St.Dev_p3")

#Average of averages no compound
av_av_nc<-data.frame()
av_av_nc[1,1]<-mean(avret_no_comp[,1], na.rm=TRUE)
av_av_nc[1,2]<-mean(avret_no_comp[,2], na.rm=TRUE)
av_av_nc[1,3]<-mean(avret_no_comp[,3], na.rm=TRUE)
av_av_nc[1,4]<-mean(avret_no_comp[,4], na.rm=TRUE)
av_av_nc[2,1]<-sd(avret_no_comp[,1], na.rm=TRUE)
av_av_nc[2,2]<-sd(avret_no_comp[,2], na.rm=TRUE)
av_av_nc[2,3]<-sd(avret_no_comp[,3], na.rm=TRUE)
av_av_nc[2,4]<-sd(avret_no_comp[,4], na.rm=TRUE)

av_av_nc[3,1]<-mean(avret_no_comp_1pct[,1], na.rm=TRUE)
av_av_nc[3,2]<-mean(avret_no_comp_1pct[,2], na.rm=TRUE)
av_av_nc[3,3]<-mean(avret_no_comp_1pct[,3], na.rm=TRUE)
av_av_nc[3,4]<-mean(avret_no_comp_1pct[,4], na.rm=TRUE)
av_av_nc[4,1]<-sd(avret_no_comp_1pct[,1], na.rm=TRUE)
av_av_nc[4,2]<-sd(avret_no_comp_1pct[,2], na.rm=TRUE)
av_av_nc[4,3]<-sd(avret_no_comp_1pct[,3], na.rm=TRUE)
av_av_nc[4,4]<-sd(avret_no_comp_1pct[,4], na.rm=TRUE)

av_av_nc[5,1]<-mean(avret_no_comp_5pct[,1], na.rm=TRUE)
av_av_nc[5,2]<-mean(avret_no_comp_5pct[,2], na.rm=TRUE)
av_av_nc[5,3]<-mean(avret_no_comp_5pct[,3], na.rm=TRUE)
av_av_nc[5,4]<-mean(avret_no_comp_5pct[,4], na.rm=TRUE)
av_av_nc[6,1]<-sd(avret_no_comp_5pct[,1], na.rm=TRUE)
av_av_nc[6,2]<-sd(avret_no_comp_5pct[,2], na.rm=TRUE)
av_av_nc[6,3]<-sd(avret_no_comp_5pct[,3], na.rm=TRUE)
av_av_nc[6,4]<-sd(avret_no_comp_5pct[,4], na.rm=TRUE)

colnames(av_av_nc)<-c("T0","a1w","a2w","a3w")
rownames(av_av_nc)<-c("Mean_p1","St.Dev_p1","Mean_p2","St.Dev_p2","Mean_p3","St.Dev_p3")

```


COMPARE SUBPERIODS WITH COMPUNDING 
```{r}
h1<-26
h2<-52
h3<-78
h4<-104
h5<-130
#WORST 10
H1<-avret[1:h1,]
H2<-avret[(h1+1):h2,]
H3<-avret[(h2+1):h3,]
H4<-avret[(h3+1):h4,]
H5<-avret[(h4+1):h5,]

#1ST PERCENTILE
H1_1pct<-avret_1pct[1:h1,]
H2_1pct<-avret_1pct[(h1+1):h2,]
H3_1pct<-avret_1pct[(h2+1):h3,]
H4_1pct<-avret_1pct[(h3+1):h4,]
H5_1pct<-avret_1pct[(h4+1):h5,]

#5th PERCENTILE
H1_5pct<-avret_5pct[1:h1,]
H2_5pct<-avret_5pct[(h1+1):h2,]
H3_5pct<-avret_5pct[(h2+1):h3,]
H4_5pct<-avret_5pct[(h3+1):h4,]
H5_5pct<-avret_5pct[(h4+1):h5,]
```
```{r}
av_subperiod<-data.frame(nrow=10, ncol=12)
for(zz in 1:4){
  av_subperiod[1,zz]<-mean(H1[,zz],na.rm=T)
  av_subperiod[2,zz]<-sd(H1[,zz],na.rm=T)
  av_subperiod[3,zz]<-mean(H2[,zz],na.rm=T)
  av_subperiod[4,zz]<-sd(H2[,zz],na.rm=T)
  av_subperiod[5,zz]<-mean(H3[,zz],na.rm=T)
  av_subperiod[6,zz]<-sd(H3[,zz],na.rm=T)
  av_subperiod[7,zz]<-mean(H4[,zz],na.rm=T)
  av_subperiod[8,zz]<-sd(H4[,zz],na.rm=T)
  av_subperiod[9,zz]<-mean(H5[,zz],na.rm=T)
  av_subperiod[10,zz]<-sd(H5[,zz],na.rm=T)
}
for(zz in 1:4){
  av_subperiod[1,(zz+4)]<-mean(H1_1pct[,zz],na.rm=T)
  av_subperiod[2,(zz+4)]<-sd(H1_1pct[,zz],na.rm=T)
  av_subperiod[3,(zz+4)]<-mean(H2_1pct[,zz],na.rm=T)
  av_subperiod[4,(zz+4)]<-sd(H2_1pct[,zz],na.rm=T)
  av_subperiod[5,(zz+4)]<-mean(H3_1pct[,zz],na.rm=T)
  av_subperiod[6,(zz+4)]<-sd(H3_1pct[,zz],na.rm=T)
  av_subperiod[7,(zz+4)]<-mean(H4_1pct[,zz],na.rm=T)
  av_subperiod[8,(zz+4)]<-sd(H4_1pct[,zz],na.rm=T)
  av_subperiod[9,(zz+4)]<-mean(H5_1pct[,zz],na.rm=T)
  av_subperiod[10,(zz+4)]<-sd(H5_1pct[,zz],na.rm=T)
}
for(zz in 1:4){
  av_subperiod[1,(zz+8)]<-mean(H1_5pct[,zz],na.rm=T)
  av_subperiod[2,(zz+8)]<-sd(H1_5pct[,zz],na.rm=T)
  av_subperiod[3,(zz+8)]<-mean(H2_5pct[,zz],na.rm=T)
  av_subperiod[4,(zz+8)]<-sd(H2_5pct[,zz],na.rm=T)
  av_subperiod[5,(zz+8)]<-mean(H3_5pct[,zz],na.rm=T)
  av_subperiod[6,(zz+8)]<-sd(H3_5pct[,zz],na.rm=T)
  av_subperiod[7,(zz+8)]<-mean(H4_5pct[,zz],na.rm=T)
  av_subperiod[8,(zz+8)]<-sd(H4_5pct[,zz],na.rm=T)
  av_subperiod[9,(zz+8)]<-mean(H5_5pct[,zz],na.rm=T)
  av_subperiod[10,(zz+8)]<-sd(H5_5pct[,zz],na.rm=T)
}
colnames(av_subperiod)<-c("T0","a1w","a2w","a3w","T0_1pct","a1w_1pct","a2w_1pct","a3w_1pct","T0_5pct","a1w_5pct","a2w_5pct","a3w_5pct")
rownames(av_subperiod)<-c("Mean_H1","StDev_H1","Mean_H2","StDev_H2","Mean_H3","StDev_H3","Mean_H4","StDev_H4","Mean_H5","StDev_H5")
av_subperiod<-round(av_subperiod, digits=4)
```

COMPARE SUBPERIODS WITHOUT COMPOUNDING
```{r}
h1<-26
h2<-52
h3<-78
h4<-104
h5<-130
#WORST 10
H1<-avret_no_comp[1:h1,]
H2<-avret_no_comp[(h1+1):h2,]
H3<-avret_no_comp[(h2+1):h3,]
H4<-avret_no_comp[(h3+1):h4,]
H5<-avret_no_comp[(h4+1):h5,]

#1ST PERCENTILE
H1_1pct<-avret_no_comp_1pct[1:h1,]
H2_1pct<-avret_no_comp_1pct[(h1+1):h2,]
H3_1pct<-avret_no_comp_1pct[(h2+1):h3,]
H4_1pct<-avret_no_comp_1pct[(h3+1):h4,]
H5_1pct<-avret_no_comp_1pct[(h4+1):h5,]

#5th PERCENTILE
H1_5pct<-avret_no_comp_5pct[1:h1,]
H2_5pct<-avret_no_comp_5pct[(h1+1):h2,]
H3_5pct<-avret_no_comp_5pct[(h2+1):h3,]
H4_5pct<-avret_no_comp_5pct[(h3+1):h4,]
H5_5pct<-avret_no_comp_5pct[(h4+1):h5,]
```
```{r}
av_subperiod<-data.frame(nrow=10, ncol=12)
for(zz in 1:4){
  av_subperiod[1,zz]<-mean(H1[,zz],na.rm=T)
  av_subperiod[2,zz]<-sd(H1[,zz],na.rm=T)
  av_subperiod[3,zz]<-mean(H2[,zz],na.rm=T)
  av_subperiod[4,zz]<-sd(H2[,zz],na.rm=T)
  av_subperiod[5,zz]<-mean(H3[,zz],na.rm=T)
  av_subperiod[6,zz]<-sd(H3[,zz],na.rm=T)
  av_subperiod[7,zz]<-mean(H4[,zz],na.rm=T)
  av_subperiod[8,zz]<-sd(H4[,zz],na.rm=T)
  av_subperiod[9,zz]<-mean(H5[,zz],na.rm=T)
  av_subperiod[10,zz]<-sd(H5[,zz],na.rm=T)
}
for(zz in 1:4){
  av_subperiod[1,(zz+4)]<-mean(H1_1pct[,zz],na.rm=T)
  av_subperiod[2,(zz+4)]<-sd(H1_1pct[,zz],na.rm=T)
  av_subperiod[3,(zz+4)]<-mean(H2_1pct[,zz],na.rm=T)
  av_subperiod[4,(zz+4)]<-sd(H2_1pct[,zz],na.rm=T)
  av_subperiod[5,(zz+4)]<-mean(H3_1pct[,zz],na.rm=T)
  av_subperiod[6,(zz+4)]<-sd(H3_1pct[,zz],na.rm=T)
  av_subperiod[7,(zz+4)]<-mean(H4_1pct[,zz],na.rm=T)
  av_subperiod[8,(zz+4)]<-sd(H4_1pct[,zz],na.rm=T)
  av_subperiod[9,(zz+4)]<-mean(H5_1pct[,zz],na.rm=T)
  av_subperiod[10,(zz+4)]<-sd(H5_1pct[,zz],na.rm=T)
}
for(zz in 1:4){
  av_subperiod[1,(zz+8)]<-mean(H1_5pct[,zz],na.rm=T)
  av_subperiod[2,(zz+8)]<-sd(H1_5pct[,zz],na.rm=T)
  av_subperiod[3,(zz+8)]<-mean(H2_5pct[,zz],na.rm=T)
  av_subperiod[4,(zz+8)]<-sd(H2_5pct[,zz],na.rm=T)
  av_subperiod[5,(zz+8)]<-mean(H3_5pct[,zz],na.rm=T)
  av_subperiod[6,(zz+8)]<-sd(H3_5pct[,zz],na.rm=T)
  av_subperiod[7,(zz+8)]<-mean(H4_5pct[,zz],na.rm=T)
  av_subperiod[8,(zz+8)]<-sd(H4_5pct[,zz],na.rm=T)
  av_subperiod[9,(zz+8)]<-mean(H5_5pct[,zz],na.rm=T)
  av_subperiod[10,(zz+8)]<-sd(H5_5pct[,zz],na.rm=T)
}
colnames(av_subperiod)<-c("T0","a1w","a2w","a3w","T0_1pct","a1w_1pct","a2w_1pct","a3w_1pct","T0_5pct","a1w_5pct","a2w_5pct","a3w_5pct")
rownames(av_subperiod)<-c("Mean_H1","StDev_H1","Mean_H2","StDev_H2","Mean_H3","StDev_H3","Mean_H4","StDev_H4","Mean_H5","StDev_H5")
av_subperiod<-round(av_subperiod, digits=4)
```



```{r}
#install.packages("RcppRoll")
#mov_aver<-rollmean(ret_nyse_cncn, 5)
#mov_aver
```

#################################      Index     ###########################
#################################      Index     ###########################
#################################      Index     ###########################

Comparison with NYSE Index
BUY AND HOLD STRATEGY
```{r}
nyse_index<-read.csv("NYSE_Index - Copy (2).csv")
nyse_index<-nyse_index[-131,]


ret_w2_nc<-as.data.frame(nyse_index[-1,3])
ret_w2_nc[130,1]<-NA
ret_w3_nc<-as.data.frame(nyse_index[-c(1,2),3])
ret_w3_nc[129:130,1]<-NA
nyse_index_nc<-as.data.frame(nyse_index[,3])
nyse_index_nc<-cbind(nyse_index_nc,ret_w2_nc,ret_w3_nc)
colnames(nyse_index_nc)<-c("a1w","a2w","a3w")



mean_1w<-mean(nyse_index[,3], na.rm=TRUE)
mean_2w<-mean(nyse_index[,4], na.rm=TRUE)
mean_3w<-mean(nyse_index[,5], na.rm=TRUE)
mean_index<-c(mean_1w,mean_2w,mean_3w)

par(mfrow = c(1, 4))
boxplot(avret, las=2, outline=FALSE, col=2, ylab="Return", main="Worst 10")
boxplot(avret_1pct, las=2, outline=FALSE, col=3, ylab="Return", main="99th Percentile")
boxplot(avret_5pct, las=2, outline=FALSE, col=4, ylab="Return", main="95th Percentile")
boxplot(nyse_index[,3:5], las=2, outline=FALSE, ylab="Return", main="Index")
boxplot(avret_no_comp,las=2, outline=FALSE, col = 2, ylab="Return", main="Worst 10 No Comp")
boxplot(avret_no_comp_1pct,las=2, outline=FALSE, col=3, ylab="Return", main="99th Percentile No Comp")
boxplot(avret_no_comp_5pct,las=2, outline=FALSE, col=4, ylab="Return", main="95th Percentile No Comp")
boxplot(nyse_index_nc, las=2, outline=FALSE, ylab="Return", main="Index No Comp")
boxplot(nyse_index_nc, las=2, outline=FALSE, ylab="Return", main="Index")

```


```{R}
#Portfolios VS Index 1 week

PvI_1w_10<-as.data.frame(ret_1w[,11]-nyse_index[,3])
PvI_1w_10$Delta<-(as.integer(PvI_1w_10[,1]>0))
PvI_1w_10<-PvI_1w_10[-130,]

PvI_1w_1pct<-as.data.frame(ret_1w_1pct[,21]-nyse_index[,3])
PvI_1w_1pct$Delta<-(as.integer(PvI_1w_1pct[,1]>0))
PvI_1w_1pct<-PvI_1w_1pct[-130,]

PvI_1w_5pct<-as.data.frame(ret_1w_5pct[,96]-nyse_index[,3])
PvI_1w_5pct$Delta<-(as.integer(PvI_1w_5pct[,1]>0))
PvI_1w_5pct<-PvI_1w_5pct[-130,]

```

```{r}
#Portfolios VS Index 2 weeks

PvI_2w_10<-as.data.frame(ret_2w_c[,11]-nyse_index[,4])
PvI_2w_10$Delta<-(as.integer(PvI_2w_10[,1]>0))
PvI_2w_10<-PvI_2w_10[-c(129,130),]


PvI_2w_1pct<-as.data.frame(ret_2w_c_1pct[,21]-nyse_index[,4])
PvI_2w_1pct$Delta<-(as.integer(PvI_2w_1pct[,1]>0))
PvI_2w_1pct<-PvI_2w_1pct[-c(129,130),]


PvI_2w_5pct<-as.data.frame(ret_2w_c_5pct[,96]-nyse_index[,4])
PvI_2w_5pct$Delta<-(as.integer(PvI_2w_5pct[,1]>0))
PvI_2w_5pct<-PvI_2w_5pct[-c(129,130),]

```

```{r}
# Portfolios VS Index 3 weeks

PvI_3w_10<-as.data.frame(ret_3w_c[,11]-nyse_index[,5])
PvI_3w_10$Delta<-(as.integer(PvI_3w_10[,1]>0))
PvI_3w_10<-PvI_3w_10[-c(128,129,130),]


PvI_3w_1pct<-as.data.frame(ret_3w_c_1pct[,21]-nyse_index[,5])
PvI_3w_1pct$Delta<-(as.integer(PvI_3w_1pct[,1]>0))
PvI_3w_1pct<-PvI_3w_1pct[-c(128,129,130),]


PvI_3w_5pct<-as.data.frame(ret_3w_c_5pct[,96]-nyse_index[,5])
PvI_3w_5pct$Delta<-(as.integer(PvI_3w_5pct[,1]>0))
PvI_3w_5pct<-PvI_3w_5pct[-c(128,129,130),]


```
Create dataset summarizing the findings
```{r}
PvI<-data.frame(ncol=9,nrow=3)
PvI[1,1]<-sum(PvI_1w_10$Delta)/nrow(PvI_1w_10)
PvI[1,2]<-mean(PvI_1w_10[,1])
PvI[1,3]<-sd(PvI_1w_10[,1])
PvI[1,4]<-sum(PvI_1w_1pct$Delta)/nrow(PvI_1w_1pct)
PvI[1,5]<-mean(PvI_1w_1pct[,1])
PvI[1,6]<-sd(PvI_1w_1pct[,1])
PvI[1,7]<-sum(PvI_1w_5pct$Delta)/nrow(PvI_1w_5pct)
PvI[1,8]<-mean(PvI_1w_5pct[,1])
PvI[1,9]<-sd(PvI_1w_5pct[,1])

PvI[2,1]<-sum(PvI_2w_10$Delta)/nrow(PvI_2w_10)
PvI[2,2]<-mean(PvI_2w_10[,1])
PvI[2,3]<-sd(PvI_2w_10[,1])
PvI[2,4]<-sum(PvI_2w_1pct$Delta)/nrow(PvI_2w_1pct)
PvI[2,5]<-mean(PvI_2w_1pct[,1])
PvI[2,6]<-sd(PvI_2w_1pct[,1])
PvI[2,7]<-sum(PvI_2w_5pct$Delta)/nrow(PvI_2w_5pct)
PvI[2,8]<-mean(PvI_2w_5pct[,1])
PvI[2,9]<-sd(PvI_2w_5pct[,1])

PvI[3,1]<-sum(PvI_3w_10$Delta)/nrow(PvI_3w_10)
PvI[3,2]<-mean(PvI_3w_10[,1])
PvI[3,3]<-sd(PvI_3w_10[,1])
PvI[3,4]<-sum(PvI_3w_1pct$Delta)/nrow(PvI_3w_1pct)
PvI[3,5]<-mean(PvI_3w_1pct[,1])
PvI[3,6]<-sd(PvI_3w_1pct[,1])
PvI[3,7]<-sum(PvI_3w_5pct$Delta)/nrow(PvI_3w_5pct)
PvI[3,8]<-mean(PvI_3w_5pct[,1])
PvI[3,9]<-sd(PvI_3w_5pct[,1])

colnames(PvI)<-c("%_Above_Ind","Mean_Diff_W10","StDev_10","%_Above_Ind","Mean_Diff_1pct","StDev_1pct","%_Above_Ind","Mean_Diff_5pct","StDev_5pct")
rownames(PvI)<-c("Week 1","Week 2", "Week 3")
```


```{r}
set.seed(123)
ran_check<-runif(15, min=1, max=1870)
#acf(t_nyse[ran_check], lag.max = 130)
#acf(ret_nyse[,ran_check],lag.max = 130)

par(mfrow = c(3, 5))
for(z in 1:15){
  acf(t_nyse[,ran_check[z]], lag.max=130, main="", xlab="")
}
par(mfrow = c(3, 5))
for(z in 1:15){
  acf(ret_nyse[,ran_check[z]], lag.max=130, main="", xlab="")
}
```



#################################      CORRELATION     ###########################
#################################      CORRELATION     ###########################
#################################      CORRELATION     ###########################


```{r}
data_for_cor<-data.frame()
  for(xx in 1:10){
    data_for_cor[xx,1]<-cor(ret_worst_10[-130,xx],ret_1w[-130,xx])
    data_for_cor[xx,2]<-cor(ret_worst_10[-c(129,130),xx],ret_2w[-c(129,130),xx])
    data_for_cor[xx,3]<-cor(ret_worst_10[-c(128,129,130),xx],ret_3w[-c(128,129,130),xx])
  }
colnames(data_for_cor)<-c("Week 1", "Week 2", "Week 3")

data_for_cor_1pct<-data.frame()
  for(xx in 1:20){
    data_for_cor_1pct[xx,1]<-cor(ret_worst_n_1pct[-130,xx],ret_1w_1pct[-130,xx])
    data_for_cor_1pct[xx,2]<-cor(ret_worst_n_1pct[-c(129,130),xx],ret_2w_1pct[-c(129,130),xx])
    data_for_cor_1pct[xx,3]<-cor(ret_worst_n_1pct[-c(128,129,130),xx],ret_3w_1pct[-c(128,129,130),xx])
  }
colnames(data_for_cor_1pct)<-c("Week 1", "Week 2", "Week 3")

data_for_cor_5pct<-data.frame()
  for(xx in 1:95){
    data_for_cor_5pct[xx,1]<-cor(ret_worst_n_5pct[-130,xx],ret_1w_5pct[-130,xx])
    data_for_cor_5pct[xx,2]<-cor(ret_worst_n_5pct[-c(129,130),xx],ret_2w_5pct[-c(129,130),xx])
    data_for_cor_5pct[xx,3]<-cor(ret_worst_n_5pct[-c(128,129,130),xx],ret_3w_5pct[-c(128,129,130),xx])
  }
colnames(data_for_cor_5pct)<-c("Week 1", "Week 2", "Week 3")


av_cor<-data.frame()
for(yy in 1:3){
  av_cor[1,yy]<-mean(data_for_cor[,yy])
  av_cor[2,yy]<-mean(data_for_cor_1pct[,yy])
  av_cor[3,yy]<-mean(data_for_cor_5pct[,yy])
}
rownames(av_cor)<-c("Worst 10","99th Pct","95th Pct")
colnames(av_cor)<-c("Week 1", "Week 2", "Week 3")

```

```{r}

library(corrplot)
par(mfrow = c(2, 3))
data_for_cor_10_01<-cor(ret_worst_10[-130,-11],ret_1w[-130,-11])
data_for_cor_10_02<-cor(ret_worst_10[-c(129,130),],ret_2w[-c(129,130),])
data_for_cor_10_03<-cor(ret_worst_10[-c(128,129,130),],ret_3w[-c(128,129,130),])
data_for_cor_10_12<-cor(ret_1w[-c(129,130),],ret_2w[-c(129,130),])
data_for_cor_10_13<-cor(ret_1w[-c(128,129,130),],ret_3w[-c(128,129,130),])
data_for_cor_10_23<-cor(ret_2w[-c(128,129,130),],ret_3w[-c(128,129,130),])


corrplot(data_for_cor_10_01,method='color',type="upper", title="T0 and Week 1", mar=c(0,0,1,0))
corrplot(data_for_cor_10_02,method='color',type="upper", main="T0 and Week 2", mar=c(0,0,1,0))
corrplot(data_for_cor_10_03,method='color',type="upper", main="T0 and Week 3", mar=c(0,0,1,0))
corrplot(data_for_cor_10_12,method='color',type="upper", main="T1 and Week 2", mar=c(0,0,1,0))
#corrplot(data_for_cor_10_13,method='color',type="upper",addCoef.col = "black", main="T1 and Week 3", mar=c(0,0,1,0))
#corrplot(data_for_cor_10_23,method='color',type="upper",addCoef.col = "black", main="T2 and Week 3", mar=c(0,0,1,0))


```
Correlations 1 percentile
```{r}
library(corrplot)
par(mfrow = c(2, 3))
data_for_cor_10_01<-cor(ret_worst_n_1pct[-130,-21],ret_1w_1pct[-130,-21])
data_for_cor_10_02<-cor(ret_worst_n_1pct[-c(129,130),],ret_2w_1pct[-c(129,130),])
data_for_cor_10_03<-cor(ret_worst_n_1pct[-c(128,129,130),],ret_3w_1pct[-c(128,129,130),])
data_for_cor_10_12<-cor(ret_1w[-c(129,130),],ret_2w[-c(129,130),])
data_for_cor_10_13<-cor(ret_1w[-c(128,129,130),],ret_3w[-c(128,129,130),])
data_for_cor_10_23<-cor(ret_2w[-c(128,129,130),],ret_3w[-c(128,129,130),])


corrplot(data_for_cor_10_01,method='color',type="upper", title="T0 and Week 1", mar=c(0,0,1,0))
corrplot(data_for_cor_10_02,method='color',type="upper", main="T0 and Week 2", mar=c(0,0,1,0))
corrplot(data_for_cor_10_03,method='color',type="upper", main="T0 and Week 3", mar=c(0,0,1,0))
corrplot(data_for_cor_10_12,method='color',type="upper", main="T1 and Week 2", mar=c(0,0,1,0))
#corrplot(data_for_cor_10_13,method='color',type="upper",addCoef.col = "black", main="T1 and Week 3", mar=c(0,0,1,0))
#corrplot(data_for_cor_10_23,method='color',type="upper",addCoef.col = "black", main="T2 and Week 3", mar=c(0,0,1,0))


```

Correlations 5 percentile
```{r}
library(corrplot)
#par(mfrow = c(2, 3))
data_for_cor_10_01<-cor(ret_worst_n_5pct[-130,-96],ret_1w_5pct[-130,-96])
data_for_cor_10_02<-cor(ret_worst_n_5pct[-c(129,130),],ret_2w_5pct[-c(129,130),])
data_for_cor_10_03<-cor(ret_worst_n_5pct[-c(128,129,130),],ret_3w_5pct[-c(128,129,130),])
data_for_cor_10_12<-cor(ret_1w[-c(129,130),],ret_2w[-c(129,130),])
data_for_cor_10_13<-cor(ret_1w[-c(128,129,130),],ret_3w[-c(128,129,130),])
data_for_cor_10_23<-cor(ret_2w[-c(128,129,130),],ret_3w[-c(128,129,130),])


corrplot(data_for_cor_10_01,method='color',type="upper", title="T0 and Week 1", mar=c(0,0,1,0))
corrplot(data_for_cor_10_02,method='color',type="upper", main="T0 and Week 2", mar=c(0,0,1,0))
corrplot(data_for_cor_10_03,method='color',type="upper", main="T0 and Week 3", mar=c(0,0,1,0))
corrplot(data_for_cor_10_12,method='color',type="upper",addCoef.col = "black", main="T1 and Week 2", mar=c(0,0,1,0))
#corrplot(data_for_cor_10_13,method='color',type="upper",addCoef.col = "black", main="T1 and Week 3", mar=c(0,0,1,0))
#corrplot(data_for_cor_10_23,method='color',type="upper",addCoef.col = "black", main="T2 and Week 3", mar=c(0,0,1,0))


```


Correlations:
```{r}
library(PerformanceAnalytics)
ret_worst_10$Average<-rowMeans(ret_worst_10)
ret_worst_10_a<-ret_worst_10[-c(128,129,130),]
ret_1w_a<-ret_1w[-c(128,129,130),]
ret_2w_a<-ret_2w_c[-c(128,129,130),]
ret_3w_a<-ret_3w_c[-c(128,129,130),]
cor(ret_1w_a$Average1w,ret_2w_a$Average2w, method='pearson')
cor(ret_1w_a$Average1w,ret_3w_a$Average3w, method='pearson')
cor(ret_2w_a$Average2w,ret_3w_a$Average3w, method='pearson')
co_av_0123<-cbind(ret_worst_10_a,ret_1w_a,ret_3w_a,ret_3w_a)
#cor(co_av_0123[,1], method='pearson')
```


#################################      HYPOTHESIS TESTING     ###########################
#################################      HYPOTHESIS TESTING     ###########################
#################################      HYPOTHESIS TESTING     ###########################


```{r}
#plot distribution of returns
#hist(avret[,4], breaks = 100)
par(mfrow = c(2, 3))
hist(avret_no_comp[,2], breaks=100,ylim = c(0,20), xlim=c(-.4,1), main="Returns Distribution P1: Week 1", normalcurve=TRUE)
hist(avret_no_comp[,3], breaks=100, ylim = c(0,15),xlim=c(-.4,.4), main="Returns Distribution P1: Week 2")
hist(avret_no_comp[,4], breaks=100, ylim = c(0,15),xlim=c(-.3,1), main="Returns Distribution P1: Week 3")
hist(avret_no_comp[,4], breaks=100, xlim=c(-.3,1), main="Returns Distribution portfolio 1: Week 3")

```
```{r}
par(mfrow = c(2, 3))
hist(avret_no_comp_1pct[,2], breaks=100, ylim = c(0,15), xlim=c(-.4,1), main="Returns Distribution P2: Week 1")
hist(avret_no_comp_1pct[,3], breaks=100, ylim = c(0,8), xlim=c(-.4,.4), main="Returns Distribution P2: Week 2")
hist(avret_no_comp_1pct[,4], breaks=100, ylim = c(0,15), xlim=c(-.3,.8), main="Returns Distribution P2: Week 3")
hist(avret_no_comp[,4], breaks=100, xlim=c(-.3,1), main="Returns Distribution portfolio 1: Week 3")
```
```{r}
par(mfrow = c(2, 3))
hist(avret_no_comp_5pct[,2], breaks=100, ylim = c(0,20), xlim=c(-.4,.7), main="Returns Distribution P3: Week 1")
hist(avret_no_comp_5pct[,3], breaks=100, ylim = c(0,10), xlim=c(-.4,.4), main="Returns Distribution P3: Week 2")
hist(avret_no_comp_5pct[,4], breaks=100, ylim = c(0,20), xlim=c(-.3,.6), main="Returns Distribution P3: Week 3")
hist(avret_no_comp[,4], breaks=100, xlim=c(-.3,1), main="Returns Distribution portfolio 1: Week 3")
```
```{r}
#SHAPIRO WILK TEST FOR NORMALITY

shap<-data.frame()
  shap[1,1]<-shapiro.test(avret_no_comp[-130,2])[2]
  shap[1,2]<-shapiro.test(avret_no_comp[-c(129,130),3])[2]
  shap[1,3]<-shapiro.test(avret_no_comp[-c(128,129,130),4])[2]
  shap[2,1]<-shapiro.test(avret_no_comp_1pct[-130,2])[2]
  shap[2,2]<-shapiro.test(avret_no_comp_1pct[-c(129,130),3])[2]
  shap[2,3]<-shapiro.test(avret_no_comp_1pct[-c(128,129,130),4])[2]
  shap[3,1]<-shapiro.test(avret_no_comp_5pct[-130,2])[2]
  shap[3,2]<-shapiro.test(avret_no_comp_5pct[-c(129,130),3])[2]
  shap[3,3]<-shapiro.test(avret_no_comp_5pct[-c(128,129,130),4])[2]
```


```{r}
t.test(PvI_1w_10[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)

t.test(avret[,2],nyse_index[,3],
       alternative = "greater",
       mu = 0, paired = TRUE, var.equal = FALSE,
       conf.level = 0.95)
```


```{r}
t.test(PvI_2w_10[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
```
```{r}
t.test(PvI_3w_10[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
```

```{r}
t.test(PvI_1w_1pct[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
t.test(PvI_2w_1pct[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
t.test(PvI_3w_1pct[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
```
```{r}
t.test(PvI_1w_5pct[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
t.test(PvI_2w_5pct[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
t.test(PvI_3w_5pct[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
```

LOAD DATA FROM WINNERS TO MAKE COMPARISONS WITH PORTFOLIOS OF LOSERS
```{r}
w_avret<- read.csv("Avret_W.csv", header=TRUE, sep=",")
w_avret_1pct<- read.csv("Avret_1pct_W.csv", header=TRUE, sep=",")
w_avret_5pct<- read.csv("Avret_5pct_W.csv", header=TRUE, sep=",")
```

```{R}
#Portfolios VS Winners 1 week

PvW_1w_10<-as.data.frame(ret_1w[,11]-w_avret[,2])
PvW_1w_10$Delta<-(as.integer(PvW_1w_10[,1]>0))
PvW_1w_10<-PvW_1w_10[-130,]

PvW_1w_1pct<-as.data.frame(ret_1w_1pct[,21]-w_avret_1pct[,2])
PvW_1w_1pct$Delta<-(as.integer(PvW_1w_1pct[,1]>0))
PvW_1w_1pct<-PvW_1w_1pct[-130,]

PvW_1w_5pct<-as.data.frame(ret_1w_5pct[,96]-w_avret_5pct[,2])
PvW_1w_5pct$Delta<-(as.integer(PvW_1w_5pct[,1]>0))
PvW_1w_5pct<-PvW_1w_5pct[-130,]

```

```{r}
#Portfolios VS Winners 2 weeks

PvW_2w_10<-as.data.frame(ret_2w_c[,11]-w_avret[,3])
PvW_2w_10$Delta<-(as.integer(PvW_2w_10[,1]>0))
PvW_2w_10<-PvW_2w_10[-c(129,130),]


PvW_2w_1pct<-as.data.frame(ret_2w_c_1pct[,21]-w_avret_1pct[,3])
PvW_2w_1pct$Delta<-(as.integer(PvW_2w_1pct[,1]>0))
PvW_2w_1pct<-PvW_2w_1pct[-c(129,130),]


PvW_2w_5pct<-as.data.frame(ret_2w_c_5pct[,96]-w_avret_5pct[,3])
PvW_2w_5pct$Delta<-(as.integer(PvW_2w_5pct[,1]>0))
PvW_2w_5pct<-PvW_2w_5pct[-c(129,130),]

```

```{r}
# Portfolios VS Index 3 weeks

PvW_3w_10<-as.data.frame(ret_3w_c[,11]-w_avret[,4])
PvW_3w_10$Delta<-(as.integer(PvW_3w_10[,1]>0))
PvW_3w_10<-PvW_3w_10[-c(128,129,130),]


PvW_3w_1pct<-as.data.frame(ret_3w_c_1pct[,21]-w_avret_1pct[,4])
PvW_3w_1pct$Delta<-(as.integer(PvW_3w_1pct[,1]>0))
PvW_3w_1pct<-PvW_3w_1pct[-c(128,129,130),]


PvW_3w_5pct<-as.data.frame(ret_3w_c_5pct[,96]-w_avret_5pct[,4])
PvW_3w_5pct$Delta<-(as.integer(PvW_3w_5pct[,1]>0))
PvW_3w_5pct<-PvW_3w_5pct[-c(128,129,130),]


```
Create dataset summarizing the findings
```{r}
PvW<-data.frame(ncol=9,nrow=3)
PvW[1,1]<-sum(PvW_1w_10$Delta)/nrow(PvW_1w_10)
PvW[1,2]<-mean(PvW_1w_10[,1])
PvW[1,3]<-sd(PvW_1w_10[,1])
PvW[1,4]<-sum(PvW_1w_1pct$Delta)/nrow(PvW_1w_1pct)
PvW[1,5]<-mean(PvW_1w_1pct[,1])
PvW[1,6]<-sd(PvW_1w_1pct[,1])
PvW[1,7]<-sum(PvW_1w_5pct$Delta)/nrow(PvW_1w_5pct)
PvW[1,8]<-mean(PvW_1w_5pct[,1])
PvW[1,9]<-sd(PvW_1w_5pct[,1])

PvW[2,1]<-sum(PvW_2w_10$Delta)/nrow(PvW_2w_10)
PvW[2,2]<-mean(PvW_2w_10[,1])
PvW[2,3]<-sd(PvW_2w_10[,1])
PvW[2,4]<-sum(PvW_2w_1pct$Delta)/nrow(PvW_2w_1pct)
PvW[2,5]<-mean(PvW_2w_1pct[,1])
PvW[2,6]<-sd(PvW_2w_1pct[,1])
PvW[2,7]<-sum(PvW_2w_5pct$Delta)/nrow(PvW_2w_5pct)
PvW[2,8]<-mean(PvW_2w_5pct[,1])
PvW[2,9]<-sd(PvW_2w_5pct[,1])

PvW[3,1]<-sum(PvW_3w_10$Delta)/nrow(PvW_3w_10)
PvW[3,2]<-mean(PvW_3w_10[,1])
PvW[3,3]<-sd(PvW_3w_10[,1])
PvW[3,4]<-sum(PvW_3w_1pct$Delta)/nrow(PvW_3w_1pct)
PvW[3,5]<-mean(PvW_3w_1pct[,1])
PvW[3,6]<-sd(PvW_3w_1pct[,1])
PvW[3,7]<-sum(PvW_3w_5pct$Delta)/nrow(PvW_3w_5pct)
PvW[3,8]<-mean(PvW_3w_5pct[,1])
PvW[3,9]<-sd(PvW_3w_5pct[,1])

colnames(PvW)<-c("%_Above_Ind","Mean_Diff_W10","StDev_10","%_Above_Ind","Mean_Diff_1pct","StDev_1pct","%_Above_Ind","Mean_Diff_5pct","StDev_5pct")
rownames(PvW)<-c("Week 1","Week 2", "Week 3")
```


T-TEST PORFTOLIOS VS WINNERS

```{r}
t.test(PvW_1w_10[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
t.test(PvW_2w_10[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
t.test(PvW_3w_10[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
``` 

```{r}
t.test(PvW_1w_1pct[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
t.test(PvW_2w_1pct[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
t.test(PvW_3w_1pct[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
```

```{r}
t.test(PvW_1w_5pct[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
t.test(PvW_2w_5pct[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
t.test(PvW_3w_5pct[,1],
       alternative = "greater",
       mu = 0, paired = FALSE, var.equal = FALSE,
       conf.level = 0.95)
```



#################################      PREDICTIVE ANALYSIS     ###########################
#################################      PREDICTIVE ANALYSIS     ###########################
#################################      PREDICTIVE ANALYSIS     ###########################

Create new dataset with all observation in one column, don't care about the week

```{r}
dataformodel<-data.frame(
  Ticker_num=numeric(),
 T0=numeric(),
 W1=logical(),
 W2=logical(),
 W3=logical(),
 W4=logical(),
 W5=logical(),
 W6=logical(),
 W7=logical(),
 W8=logical(),
 W9=logical(),
 W10=logical(),
 Aver_Ret=numeric(),
 Ret_1W=numeric(),
 Ret_2W=numeric(),
 Ret_3W=numeric()
 )

for(n in 1:130){
  for(o in 1:10){
    aa<-as.numeric(weekly_sort_n[n,o])
    bb<-ret_worst_10[n,o]
    c1<-o == 1
    c2<-o == 2
    c3<-o == 3
    c4<-o == 4
    c5<-o == 5
    c6<-o == 6
    c7<-o == 7
    c8<-o == 8
    c9<-o == 9
    c10<-o == 10
    dd<-av_ret_tot[1,aa]
    ee<-ret_1w[n,o]
    ff<-ret_2w[n,o]
    gg<-ret_3w[n,o]
    hh<-c(aa,bb,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,dd,ee,ff,gg)
    dataformodel<-rbind(dataformodel,hh)
    }
}
colnames(dataformodel)<-c("Ticker_num","T0","W1","W2","W3","W4","W5","W6","W7","W8","W9","W10",
                          "Aver_Ret","Ret_1w","Ret_2w","Ret_3w")
```

create train and test dataset

```{r}
dataformodel_clean<-na.omit(dataformodel)
sample_size<-floor(0.75*nrow(dataformodel_clean))
set.seed(123)
trainset<-sample(seq_len(nrow(dataformodel_clean)), size=sample_size)

train_data<-dataformodel_clean[trainset,]
test_data<-dataformodel_clean[-trainset,]

```

Create new dataset with all observation in one column, don't care about the week number for the 1st percentile

```{r}
dataformodel_1pct<-data.frame(
  Ticker_num=numeric(),
 #T0=numeric(),
 #W1=logical(),
 #W2=logical(),
 #W3=logical(),
 #W4=logical(),
 #W5=logical(),
 #W6=logical(),
 #W7=logical(),
 #W8=logical(),
 #W9=logical(),
 #W10=logical(),
 Aver_Ret=numeric(),
 Ret_1W=numeric(),
 Ret_2W=numeric(),
 Ret_3W=numeric()
 )

for(p in 1:130){
  for(q in 1:20){
    aa_1<-as.numeric(weekly_sort_n_1pct[p,q])
    bb_1<-ret_worst_n_1pct[p,q]
    #c1<-o == 1
    #c2<-o == 2
    #c3<-o == 3
    #c4<-o == 4
    #c5<-o == 5
    #c6<-o == 6
    #c7<-o == 7
    #c8<-o == 8
    #c9<-o == 9
    #c10<-o == 10
    dd_1<-av_ret_tot[1,aa]
    ee_1<-ret_1w_1pct[p,q]
    ff_1<-ret_2w_1pct[p,q]
    gg_1<-ret_3w_1pct[p,q]
    hh_1<-c(aa_1,bb_1,dd_1,ee_1,ff_1,gg_1)
    #c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,
    dataformodel_1pct<-rbind(dataformodel_1pct,hh_1)
    }
}
colnames(dataformodel_1pct)<-c("Ticker_num","T0","Aver_Ret","Ret_1w","Ret_2w","Ret_3w")
    #"T0","W1","W2","W3","W4","W5","W6","W7","W8","W9","W10",

```

create train and test dataset

```{r}
dataformodel_1pct_clean<-na.omit(dataformodel_1pct)
sample_size_1pct<-floor(0.75*nrow(dataformodel_1pct_clean))
set.seed(123)
trainset_1pct<-sample(seq_len(nrow(dataformodel_1pct_clean)), size=sample_size_1pct)

train_data_1pct<-dataformodel_1pct_clean[trainset_1pct,]
test_data_1pct<-dataformodel_1pct_clean[-trainset_1pct,]

```

Create new dataset with all observation in one column for the 5th percentile

```{r}
dataformodel_5pct<-data.frame(
  Ticker_num=numeric(),
 #T0=numeric(),
 #W1=logical(),
 #W2=logical(),
 #W3=logical(),
 #W4=logical(),
 #W5=logical(),
 #W6=logical(),
 #W7=logical(),
 #W8=logical(),
 #W9=logical(),
 #W10=logical(),
 Aver_Ret=numeric(),
 Ret_1W=numeric(),
 Ret_2W=numeric(),
 Ret_3W=numeric()
 )

for(p in 1:130){
  for(q in 1:95){
    aa_5<-as.numeric(weekly_sort_n_5pct[p,q])
    bb_5<-ret_worst_n_5pct[p,q]
    #c1<-o == 1
    #c2<-o == 2
    #c3<-o == 3
    #c4<-o == 4
    #c5<-o == 5
    #c6<-o == 6
    #c7<-o == 7
    #c8<-o == 8
    #c9<-o == 9
    #c10<-o == 10
    dd_5<-av_ret_tot[1,aa]
    ee_5<-ret_1w_5pct[p,q]
    ff_5<-ret_2w_5pct[p,q]
    gg_5<-ret_3w_5pct[p,q]
    hh_5<-c(aa_5,bb_5,dd_5,ee_5,ff_5,gg_5)
    #c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,
    dataformodel_5pct<-rbind(dataformodel_5pct,hh_5)
    }
}
colnames(dataformodel_5pct)<-c("Ticker_num","T0","Aver_Ret","Ret_1w","Ret_2w","Ret_3w")
    #"T0","W1","W2","W3","W4","W5","W6","W7","W8","W9","W10",

```

create train and test dataset

```{r}
dataformodel_5pct_clean<-na.omit(dataformodel_5pct)
sample_size_5pct<-floor(0.75*nrow(dataformodel_5pct_clean))
set.seed(123)
trainset_5pct<-sample(seq_len(nrow(dataformodel_5pct_clean)), size=sample_size_5pct)

train_data_5pct<-dataformodel_5pct_clean[trainset_5pct,]
test_data_5pct<-dataformodel_5pct_clean[-trainset_5pct,]

```





Simple model 1W: use only this week return to predict the return in 1 weeks
```{r}
library(caret)

m1_t0_1w<-lm(Ret_1w~T0, data=train_data)
summary(m1_t0_1w)
pred_m1_t0_1w<-predict(m1_t0_1w, test_data)
postResample(pred = pred_m1_t0_1w, obs=test_data$Ret_1w)

m1_t0_1w_1pct<-lm(Ret_1w~T0, data=train_data_1pct)
summary(m1_t0_1w_1pct)
pred_m1_t0_1w_1pct<-predict(m1_t0_1w_1pct, test_data_1pct)
postResample(pred = pred_m1_t0_1w_1pct, obs=test_data_1pct$Ret_1w)

```
Simple model 1W: use only this week return to predict the return in 2 weeks

```{r}
m1_t0_2w<-lm(Ret_2w~T0, data=train_data)
summary(m1_t0_2w)
pred_m1_t0_2w<-predict(m1_t0_2w, test_data)
postResample(pred = pred_m1_t0_2w, obs=test_data$Ret_2w)

m1_t0_2w_1pct<-lm(Ret_2w~T0, data=train_data_1pct)
summary(m1_t0_2w_1pct)
pred_m1_t0_2w_1pct<-predict(m1_t0_2w_1pct, test_data_1pct)
postResample(pred = pred_m1_t0_1w_1pct, obs=test_data_1pct$Ret_2w)

```
Simple model 1W: use only this week return to predict the return in 3 weeks

```{r}
m1_t0_3w<-lm(Ret_3w~T0, data=train_data)
summary(m1_t0_3w)
pred_m1_t0_3w<-predict(m1_t0_3w, test_data)
postResample(pred = pred_m1_t0_3w, obs=test_data$Ret_3w)

m1_t0_3w_1pct<-lm(Ret_3w~T0, data=train_data_1pct)
summary(m1_t0_3w_1pct)
pred_m1_t0_3w_1pct<-predict(m1_t0_3w_1pct, test_data_1pct)
postResample(pred = pred_m1_t0_3w_1pct, obs=test_data_1pct$Ret_3w)

```


Simple model: use t0,ret1,and ret2 to predict the return in 1 week (3w)

```{r}
m2_T0_Ret1w_Ret2w_1w<-lm(Ret_3w~Ret_1w+Ret_2w+T0, data=train_data)
summary(m2_T0_Ret1w_Ret2w_1w)
pred_m2_T0_Ret1w_Ret2w_1w<-predict(m2_T0_Ret1w_Ret2w_1w, test_data)
postResample(pred = pred_m2_T0_Ret1w_Ret2w_1w, obs=test_data$Ret_3w)

tab_model(m2_T0_Ret1w_Ret2w_1w)

m2_T0_Ret1w_Ret2w_1w_1pct<-lm(Ret_3w~Ret_1w+Ret_2w+T0, data=train_data_1pct)
summary(m2_T0_Ret1w_Ret2w_1w_1pct)
pred_m2_T0_Ret1w_Ret2w_1w_1pct<-predict(m2_T0_Ret1w_Ret2w_1w_1pct, test_data_1pct)
postResample(pred = pred_m2_T0_Ret1w_Ret2w_1w_1pct, obs=test_data_1pct$Ret_3w)

m2_T0_Ret1w_Ret2w_1w_5pct<-lm(Ret_3w~Ret_1w+Ret_2w+T0, data=train_data_5pct)
summary(m2_T0_Ret1w_Ret2w_1w_5pct)
pred_m2_T0_Ret1w_Ret2w_1w_5pct<-predict(m2_T0_Ret1w_Ret2w_1w_5pct, test_data_5pct)
postResample(pred = pred_m2_T0_Ret1w_Ret2w_1w_5pct, obs=test_data_5pct$Ret_3w)

```


Mathematical transformations
```{r}
#CUBE W2 AND SQARE W1
train_data$Ret_1w2<-train_data$Ret_1w^2
test_data$Ret_1w2<-test_data$Ret_1w^2
train_data$Ret_2w3<-train_data$Ret_1w^3
test_data$Ret_2w3<-test_data$Ret_1w^3

train_data_1pct$Ret_1w2<-train_data_1pct$Ret_1w^2
test_data_1pct$Ret_1w2<-test_data_1pct$Ret_1w^2
train_data_1pct$Ret_2w3<-train_data_1pct$Ret_1w^3
test_data_1pct$Ret_2w3<-test_data_1pct$Ret_1w^3

train_data_5pct$Ret_1w2<-train_data_5pct$Ret_1w^2
test_data_5pct$Ret_1w2<-test_data_5pct$Ret_1w^2
train_data_5pct$Ret_2w3<-train_data_5pct$Ret_1w^3
test_data_5pct$Ret_2w3<-test_data_5pct$Ret_1w^3

#MULTIPLY W1 AND W2
train_data$Ret_1x2<-train_data$Ret_1w*train_data$Ret_2w
test_data$Ret_1x2<-test_data$Ret_1w*test_data$Ret_2w

train_data_1pct$Ret_1x2<-train_data_1pct$Ret_1w*train_data_1pct$Ret_2w
test_data_1pct$Ret_1x2<-test_data_1pct$Ret_1w*test_data_1pct$Ret_2w

train_data_5pct$Ret_1x2<-train_data_5pct$Ret_1w*train_data_5pct$Ret_2w
test_data_5pct$Ret_1x2<-test_data_5pct$Ret_1w*test_data_5pct$Ret_2w

#logarithm of T0
train_data$T0log<-log(train_data$T0*-1)
test_data$T0log<-log(test_data$T0*-1)
train_data_1pct$T0log<-log(train_data_1pct$T0*-1)
test_data_1pct$T0log<-log(test_data_1pct$T0*-1)
train_data_5pct$T0log<-log(train_data_5pct$T0*-1)
test_data_5pct$T0log<-log(test_data_5pct$T0*-1)

#exponential T0
train_data$T0exp<-exp(train_data$T0)
test_data$T0exp<-exp(test_data$T0)
train_data_1pct$T0exp<-exp(train_data_1pct$T0)
test_data_1pct$T0exp<-exp(test_data_1pct$T0)
train_data_5pct$T0exp<-exp(train_data_5pct$T0)
test_data_5pct$T0exp<-exp(test_data_5pct$T0)

#everything is exponential
train_data$T0exp<-exp(train_data$T0)
test_data$T0exp<-exp(test_data$T0)
train_data$R1exp<-exp(train_data$Ret_1w)
test_data$R1exp<-exp(test_data$Ret_1w)
train_data$R2exp<-exp(train_data$Ret_2w)
test_data$R2exp<-exp(test_data$Ret_2w)
train_data$R3exp<-exp(train_data$Ret_3w)
test_data$R3exp<-exp(test_data$Ret_3w)

train_data$Ret_1x2exp<-exp(train_data$Ret_1w*train_data$Ret_2w)
test_data$Ret_1x2exp<-exp(test_data$Ret_1w*test_data$Ret_2w)
```


```{r}
m1_t0_3w_t0e<-lm(Ret_3w~T0+T0exp, data=train_data)
summary(m1_t0_3w_t0e)
pred_m1_t0_3w_t0e<-predict(m1_t0_3w_t0e, test_data)
postResample(pred = pred_m1_t0_3w_t0e, obs=test_data$Ret_3w)
```

w1 squared w2 cube
```{r}
m3_T0_Ret1w_Ret2w_3w<-lm(Ret_3w~Ret_1w2+Ret_2w3+T0, data=train_data)
summary(m3_T0_Ret1w_Ret2w_3w)
pred_m3_T0_Ret1w_Ret2w_3w<-predict(m3_T0_Ret1w_Ret2w_3w, test_data)
postResample(pred = pred_m3_T0_Ret1w_Ret2w_3w, obs=test_data$Ret_3w)

m3_T0_Ret1w_Ret2w_3w_1pct<-lm(Ret_3w~Ret_1w2+Ret_2w3+T0, data=train_data_1pct)
summary(m3_T0_Ret1w_Ret2w_3w_1pct)
pred_m3_T0_Ret1w_Ret2w_3w_1pct<-predict(m3_T0_Ret1w_Ret2w_3w_1pct, test_data_1pct)
postResample(pred = pred_m3_T0_Ret1w_Ret2w_3w_1pct, obs=test_data_1pct$Ret_3w)

m3_T0_Ret1w_Ret2w_3w_5pct<-lm(Ret_3w~Ret_1w2+Ret_2w3+T0, data=train_data_5pct)
summary(m3_T0_Ret1w_Ret2w_3w_5pct)
pred_m3_T0_Ret1w_Ret2w_3w_5pct<-predict(m3_T0_Ret1w_Ret2w_3w_5pct, test_data_5pct)
postResample(pred = pred_m3_T0_Ret1w_Ret2w_3w_5pct, obs=test_data_5pct$Ret_3w)
```

Multiply the variables

```{r}
m4_T0_Ret1w_Ret2w_3w<-lm(Ret_3w~Ret_1x2+Ret_1w+Ret_2w+T0, data=train_data)
summary(m4_T0_Ret1w_Ret2w_3w)
pred_m4_T0_Ret1w_Ret2w_3w<-predict(m4_T0_Ret1w_Ret2w_3w, test_data)
postResample(pred = pred_m4_T0_Ret1w_Ret2w_3w, obs=test_data$Ret_3w)


train_data$T0x1<-train_data$T0*train_data$Ret_1w*-1
test_data$T0x1<-test_data$T0*test_data$Ret_1w*-1
m4_T0_Ret1w_Ret2w_3w<-lm(Ret_3w~Ret_1x2+T0x1+Ret_1w+Ret_2w+T0, data=train_data)
summary(m4_T0_Ret1w_Ret2w_3w)
pred_m4_T0_Ret1w_Ret2w_3w<-predict(m4_T0_Ret1w_Ret2w_3w, test_data)
postResample(pred = pred_m4_T0_Ret1w_Ret2w_3w, obs=test_data$Ret_3w)

#m4_T0_Ret1w_Ret2w_3w_1pct<-lm(Ret_3w~Ret_1x2+Ret_1w+Ret_2w+T0, data=train_data_1pct)
#summary(m4_T0_Ret1w_Ret2w_3w_1pct)
#pred_m4_T0_Ret1w_Ret2w_3w_1pct<-predict(m4_T0_Ret1w_Ret2w_3w_1pct, test_data_1pct)
#postResample(pred = pred_m4_T0_Ret1w_Ret2w_3w_1pct, obs=test_data_1pct$Ret_3w)

#m4_T0_Ret1w_Ret2w_3w_5pct<-lm(Ret_3w~Ret_1x2+Ret_1w+Ret_2w+T0, data=train_data_5pct)
#summary(m4_T0_Ret1w_Ret2w_3w_5pct)
#pred_m4_T0_Ret1w_Ret2w_3w_5pct<-predict(m4_T0_Ret1w_Ret2w_3w_1pct, test_data_5pct)
#postResample(pred = pred_m4_T0_Ret1w_Ret2w_3w_5pct, obs=test_data_5pct$Ret_3w)
```


Multiply and use exp
```{r}
m6_T0_Ret1w_Ret2w_3w<-lm(Ret_3w~Ret_1x2+Ret_1w+Ret_2w+T0exp, data=train_data)
summary(m6_T0_Ret1w_Ret2w_3w)
pred_m6_T0_Ret1w_Ret2w_3w<-predict(m6_T0_Ret1w_Ret2w_3w, test_data)
postResample(pred = pred_m6_T0_Ret1w_Ret2w_3w, obs=test_data$Ret_3w)

m6_T0_Ret1w_Ret2w_3w_1pct<-lm(Ret_3w~Ret_1x2+Ret_1w+Ret_2w+T0exp, data=train_data_1pct)
summary(m6_T0_Ret1w_Ret2w_3w_1pct)
pred_m6_T0_Ret1w_Ret2w_3w_1pct<-predict(m6_T0_Ret1w_Ret2w_3w_1pct, test_data_1pct)
postResample(pred = pred_m6_T0_Ret1w_Ret2w_3w_1pct, obs=test_data_1pct$Ret_3w)

m6_T0_Ret1w_Ret2w_3w_5pct<-lm(Ret_3w~Ret_1x2+Ret_1w+Ret_2w+T0exp, data=train_data_5pct)
summary(m6_T0_Ret1w_Ret2w_3w_5pct)
pred_m6_T0_Ret1w_Ret2w_3w_5pct<-predict(m6_T0_Ret1w_Ret2w_3w_5pct, test_data_5pct)
postResample(pred = pred_m6_T0_Ret1w_Ret2w_3w_5pct, obs=test_data_5pct$Ret_3w)
```
Use all exp
```{r}

m8_T0_Ret1w_Ret2w_3w<-lm(R3exp~Ret_1x2exp+R1exp+R2exp+T0exp, data=train_data)
summary(m8_T0_Ret1w_Ret2w_3w)
pred_m8_T0_Ret1w_Ret2w_3w<-predict(m8_T0_Ret1w_Ret2w_3w, test_data)
postResample(pred = pred_m8_T0_Ret1w_Ret2w_3w, obs=test_data$R3exp)


```
########################## USE THIS ################################
```{r}
m10_T0_Ret1w_Ret2w_3w<-lm(R3exp~Ret_1x2exp+R1exp+R2exp+T0exp+T0log+T0, data=train_data)
summary(m10_T0_Ret1w_Ret2w_3w)
pred_m10_T0_Ret1w_Ret2w_3w<-predict(m10_T0_Ret1w_Ret2w_3w, test_data)
postResample(pred = pred_m10_T0_Ret1w_Ret2w_3w, obs=test_data$R3exp)



m9_T0_Ret1w_Ret2w_3w<-lm(R3exp~Ret_1x2exp+T0exp+T0log+T0, data=train_data)
summary(m9_T0_Ret1w_Ret2w_3w)
pred_m9_T0_Ret1w_Ret2w_3w<-predict(m9_T0_Ret1w_Ret2w_3w, test_data)
postResample(pred = pred_m9_T0_Ret1w_Ret2w_3w, obs=test_data$R3exp)
```


```{r}

library(sjPlot)
tab_model(m1_t0_1w, m2_T0_Ret1w_Ret2w_1w, m4_T0_Ret1w_Ret2w_3w)
tab_model(m8_T0_Ret1w_Ret2w_3w, m9_T0_Ret1w_Ret2w_3w, m10_T0_Ret1w_Ret2w_3w)
```

















